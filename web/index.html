<!DOCTYPE html>
<html>
<head>
    <title>Event Booker</title>
    <script src="https://unpkg.com/htmx.org@1.9.6"></script>
    <style>
        .container { max-width: 800px; margin: 0 auto; padding: 20px; }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; }
        input, button, select { padding: 8px; width: 100%; box-sizing: border-box; }
        .event { border: 1px solid #ccc; padding: 15px; margin-bottom: 15px; }
        .booking { background: #f9f9f9; padding: 10px; margin: 10px 0; }
        .pending { background: #fff3cd; }
        .confirmed { background: #d4edda; }
        .cancelled { background: #f8d7da; }
        .tabs { display: flex; margin-bottom: 20px; }
        .tab { padding: 10px 20px; cursor: pointer; border: 1px solid #ccc; }
        .tab.active { background: #007bff; color: white; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
    </style>
</head>
<body>
<div class="container">
    <h1>Event Booker</h1>

    <div class="tabs">
        <div class="tab active" onclick="showTab('events')">Events</div>
        <div class="tab" onclick="showTab('create')">Create Event</div>
        <div class="tab" onclick="showTab('book')">Book Seats</div>
        <div class="tab" onclick="showTab('confirm')">Confirm Booking</div>
    </div>

    <div id="events-tab" class="tab-content active">
        <h2>Events List</h2>
        <div id="events-list">
            <!-- Events will be loaded here -->
        </div>
    </div>

    <div id="create-tab" class="tab-content">
        <h2>Create Event</h2>
        <form id="create-event-form" hx-post="/events" hx-target="#events-list">
            <div class="form-group">
                <label>Event Name:</label>
                <input type="text" name="name" required>
            </div>
            <div class="form-group">
                <label>Date:</label>
                <input type="datetime-local" name="date" required>
            </div>
            <div class="form-group">
                <label>Total Seats:</label>
                <input type="number" name="total_seats" required>
            </div>
            <div class="form-group">
                <label>Payment Time (minutes):</label>
                <input type="number" name="payment_time" value="30">
            </div>
            <button type="submit">Create Event</button>
        </form>
    </div>

    <div id="book-tab" class="tab-content">
        <h2>Book Seats</h2>
        <form id="book-form">
            <div class="form-group">
                <label>Event ID:</label>
                <input type="number" name="event_id" required>
            </div>
            <div class="form-group">
                <label>Your Name:</label>
                <input type="text" name="user_name" required>
            </div>
            <div class="form-group">
                <label>Number of Seats:</label>
                <input type="number" name="seats" required>
            </div>
            <button type="button" onclick="bookSeats()">Book Seats</button>
        </form>
        <div id="booking-result"></div>
    </div>

    <div id="confirm-tab" class="tab-content">
        <h2>Confirm Booking</h2>
        <form id="confirm-form">
            <div class="form-group">
                <label>Event ID:</label>
                <input type="number" name="event_id" required>
            </div>
            <div class="form-group">
                <label>Your Name:</label>
                <input type="text" name="user_name" required>
            </div>
            <button type="button" onclick="confirmBooking()">Confirm Booking</button>
        </form>
        <div id="confirmation-result"></div>
    </div>
</div>

<script>
    function showTab(tabName) {
        // Hide all tabs
        document.querySelectorAll('.tab-content').forEach(tab => {
            tab.classList.remove('active');
        });
        document.querySelectorAll('.tab').forEach(tab => {
            tab.classList.remove('active');
        });

        // Show selected tab
        document.getElementById(tabName + '-tab').classList.add('active');
        event.target.classList.add('active');
    }

    // Load events on page load
    document.addEventListener('DOMContentLoaded', function() {
        loadEvents();
    });

    function loadEvents() {
        htmx.ajax('GET', '/events', '#events-list');
    }

    function bookSeats() {
        const form = document.getElementById('book-form');
        const formData = new FormData(form);
        const eventId = formData.get('event_id');

        htmx.ajax('POST', `/events/${eventId}/book`, {
            values: {
                user_name: formData.get('user_name'),
                seats: parseInt(formData.get('seats'))
            },
            target: '#booking-result',
            swap: 'innerHTML'
        }).then(() => {
            loadEvents(); // Reload events list after booking
        });
    }

    function confirmBooking() {
        const form = document.getElementById('confirm-form');
        const formData = new FormData(form);
        const eventId = formData.get('event_id');

        htmx.ajax('POST', `/events/${eventId}/confirm`, {
            values: {
                user_name: formData.get('user_name')
            },
            target: '#confirmation-result',
            swap: 'innerHTML'
        }).then(() => {
            loadEvents(); // Reload events list after confirmation
        });
    }

    // Reset form after successful submission
    document.addEventListener('htmx:afterRequest', function(evt) {
        if (evt.detail.successful) {
            if (evt.detail.target.id === 'events-list') {
                document.getElementById('create-event-form').reset();
            }
        }
    });
</script>
</body>
</html>